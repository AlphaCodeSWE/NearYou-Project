{
    "dashboard": {
      "id": null,
      "uid": "active-users",
      "title": "Active Users",
      "tags": ["provisioned"],
      "timezone": "browser",
      "schemaVersion": 36,
      "version": 1,
      "refresh": "30s",
      "time": { "from": "now-7d", "to": "now" },
      "templating": {
        "list": [
          {
            "name": "days",
            "type": "interval",
            "label": "Last interval",
            "hide": 0,
            "query": "1h,6h,12h,1d,7d,30d,90d",
            "current": { "text": "7d", "value": "7d" },
            "options": [
              { "text": "1h", "value": "1h" },
              { "text": "6h", "value": "6h" },
              { "text": "12h", "value": "12h" },
              { "text": "1d", "value": "1d" },
              { "text": "7d", "value": "7d" },
              { "text": "30d", "value": "30d" },
              { "text": "90d", "value": "90d" }
            ]
          },
          {
            "name": "minAge",
            "type": "custom",
            "label": "Min Age",
            "hide": 0,
            "query": "0,18,25,35,50",
            "current": { "text": "0", "value": "0" },
            "options": [
              { "text": "0", "value": "0" },
              { "text": "18", "value": "18" },
              { "text": "25", "value": "25" },
              { "text": "35", "value": "35" },
              { "text": "50", "value": "50" }
            ]
          },
          {
            "name": "country",
            "type": "query",
            "label": "Country",
            "datasource": "ClickHouse",
            "query": "SELECT DISTINCT country FROM users ORDER BY country",
            "includeAll": true,
            "allValue": "",
            "multi": false,
            "current": { "text": "All", "value": "$__all" }
          }
        ]
      },
      "panels": [
        {
          "id": 1,
          "type": "geomap",
          "title": "Active Users Map",
          "gridPos": { "x": 0, "y": 0, "w": 12, "h": 8 },
          "datasource": "ClickHouse",
          "targets": [
            {
              "refId": "A",
              "format": "table",
              "rawSql": "SELECT toFloat64(longitude) AS __lon__, toFloat64(latitude) AS __lat__, user_id, full_name, age, country, max(event_time) OVER (PARTITION BY user_id) AS last_event\nFROM nearyou.user_events AS e\nANY LEFT JOIN nearyou.users AS u USING user_id\nWHERE event_time >= now() - toInterval${days}()\n  AND age >= ${minAge}\n  {{ if not (eq .Var.country \"__all\") }}AND country = '${country}'{{ end }}\n"
            }
          ],
          "fieldConfig": { "defaults": {} },
          "options": {
            "lonField": "__lon__",
            "latField": "__lat__",
            "popupFields": ["user_id", "full_name", "age", "country", "last_event"]
          }
        },
        {
          "id": 2,
          "type": "table",
          "title": "Active Users List",
          "gridPos": { "x": 12, "y": 0, "w": 12, "h": 8 },
          "datasource": "ClickHouse",
          "targets": [
            {
              "refId": "A",
              "format": "table",
              "rawSql": "SELECT user_id, full_name, email, country, age, max(event_time) AS last_event\nFROM nearyou.user_events AS e\nANY LEFT JOIN nearyou.users AS u USING user_id\nWHERE event_time >= now() - toInterval${days}()\n  AND age >= ${minAge}\n  {{ if not (eq .Var.country \"__all\") }}AND country = '${country}'{{ end }}\nGROUP BY user_id, full_name, email, country, age\nORDER BY last_event DESC\nLIMIT 500\n"
            }
          ],
          "options": { "showHeader": true },
          "fieldConfig": {
            "defaults": { "mappings": [], "custom": {} }
          }
        }
      ]
    },
    "overwrite": true
  }
  